<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Webcompat issues</title>
  <link rel="stylesheet" href="css/bootstrap.css">
  <style type="text/css">
    .plot {
      width: 540px;
      height: 250px;
    }

    .container {
      margin-top: 15px;
    }
  </style>
  <script type="text/javascript" src="js/plotly-latest.min.js" defer></script>
  <script type="text/javascript">
    // Load and plot by-domain stats
    var plotters = [];  // Registered later in the page
    document.addEventListener("DOMContentLoaded", function(event) {
      var request = new XMLHttpRequest();
      request.open("GET", "webcompat.json");
      request.responseType = "json";
      request.onload = function() {
        for (var f of plotters) { f(this.response); }
      };
      request.send();
    });
  </script>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark">
    <a class="navbar-brand" href="#">Webcompat issues</a>
  </nav>

  <div class="container">
    <div class="row">
      <div class="col">
        <h1>Webcompat issues by domain</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-sm">
        <h2>Open issues</h2>
        <div id="domains_open" class="plot"></div>
        <script type="text/javascript">
          plotters.push(function(data) {
            var y = Object.keys(data.open);
            var x = Object.values(data.open);
            Plotly.plot(
              "domains_open",
              [{x, y, type: 'bar', orientation: 'h'}],
              {
                margin: { t: 0, l: 150 },
                yaxis: { autorange: "reversed" },
              });
            });
        </script>
      </div>

      <div class="col-sm">
        <h2>All issues, last 30 days</h2>
        <div id="domains_30days" class="plot"></div>
        <script type="text/javascript">
          plotters.push(function(data) {
            var y = Object.keys(data.last30);
            var x = Object.values(data.last30);
            Plotly.plot(
              "domains_30days",
              [{x, y, type: 'bar', orientation: 'h'}],
              {
                margin: { t: 0, l: 150 },
                yaxis: { autorange: "reversed" },
              });
            });
        </script>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <h1>Frequently-duped Bugzilla bugs</h1>
        <p>Open Bugzilla bugs, ranked by the number of associated webcompat bugs.</p>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <table class="table" id="bzbugs">
          <thead class="thead-light">
            <tr>
              <th scope="col">Frequency</th>
              <th scope="col">Bugzilla ID</th>
              <th scope="col">Component</th>
              <th scope="col">Summary</th>
              <th scope="col">Associated domains</th>
            </tr>
          </thead>
        </table>
      </div>
    </div>
    <script type="text/javascript">
      plotters.push(function(data) {
        const columns = ["wc_dupes", "bugzilla_id", "component", "summary", "most_reported"];
        var table = document.getElementById("bzbugs");
        for (var value of data.bugzilla) {
          var row = table.insertRow(-1);
          for (var label of columns) {
            var cell = row.insertCell(-1);
            var text = document.createTextNode(value[label]);
            if(label == "bugzilla_id") {
              var link = document.createElement("a");
              link.href = `https://bugzilla.mozilla.org/show_bug.cgi?id=${value.bugzilla_id}`
              link.appendChild(text);
              cell.appendChild(link);
            } else {
              cell.appendChild(text);
            }
          }
        }
      });
    </script>

    <div class="row">
      <p>Last updated: <span id="last_updated"></span></p>
    </div>
    <script type="text/javascript">
      plotters.push(function(data) {
        document.getElementById("last_updated").textContent = data.last_updated;
      })
    </script>

  </div>
</body>
</html>
